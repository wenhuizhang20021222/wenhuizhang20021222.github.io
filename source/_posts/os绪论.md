---
title: os绪论
tags: 
- 操作系统
category: 
- 操作系统
abbrlink: 23723
date: 2022-06-23 11:23:57
---

# 一、操作系统绪论

## ==重点考察概念==

操作系统的定义，操作系统在计算机系统中的地位，操作系统的主要功能，资源复用、虚化、抽象，操作系统的特征，多道程序设计，并发，中断，系统调用，CPU 的两种工作模式（用户态、内核态），特权指令和非特权指令 

## 1、操作系统概念、功能及提供的接口

**操作系统的概念**：管理计算机硬件并提供应用程序运行环境的软件。操作系统是配置在计算机硬件上的第一层软件，是对硬件的首次扩充，形成了虚拟计算机/扩展机。它位于硬件与其它软件之间，是所有其他软件运行的基础。

<!-- more -->

**操作系统的作用：**

**用户视角：** 操作系统是用户与计算机硬件之间的接口。为用户使用计算机提供服务。

**系统视角：** 

- ==资源管理器== ：管理计算机系统的软硬件资源。**资源复用、资源虚化以及资源抽象** 。
    - 资源复用：分为时间复用和空间复用。时间复用指的是多个用户或程序轮流使用某个资源，如CPU使用；空间复用指的是多个用户或程序同时使用资源的一部分，如内存使用。
    - 资源虚化：让一个物理设备变成多个相对独立的对应物
    - 资源抽象：对内封装细节，对外通过管理对象与访问接口，如：面向进程而不是CPU，面向文件而不是物理存储介质，面向窗口而不是屏幕
    - ==复用与虚拟化解决的是资源不足的问题。资源抽象解决的是资源复杂的问题。==
- ==控制程序== ：控制程序执行过程，防止错误和计算机的不当使用

![image-20220513191418134](https://s2.loli.net/2022/05/13/msaGykqzLiVtrDT.png)

![image-20220513193433159](https://s2.loli.net/2022/05/13/HKJvnRhTVw89bdC.png)

![image-20220513192502110](https://s2.loli.net/2022/05/13/AQW3CRkS6fHpBNw.png)

![image-20220513193123123](https://s2.loli.net/2022/05/13/LiEpfK6Awz8WFvs.png)

联机命令接口 = 交互命令接口，如命令行

脱机命令接口 = 批处理命令接口，如*.bat文件

程序接口：如dll文件，调用dll文件即可进行系统调用，只能通过应用程序间接使用

## 2、操作系统的特征

- **并发性：** 多个事件在同一事件间隔内发生（并行：同一时刻）。并发的实质是一个物理CPU(也可以多个物理CPU) 在若干道程序之间多路复用，并发性是对有限物理资源强制行使多用户共享以提高效率。

- **共享性：** 系统中的资源可供多个并发执行的进程共同使用。有两种资源共享方式：

    - 互斥共享：一段时间只允许一个进程访问。如对摄像头设备的共享使用
    - 同时访问：一段时间允许多个进程访问。如对硬盘资源的共享使用

    ==并发和共享是操作系统的两个最基本特征，二者之间互为存在条件。== 

- **虚拟性：** 把一个物理上的实体变为若干个逻辑上的对应物；或把物理上的多个实体变成逻辑上的一个对应物的技术。eg.虚拟存储器

    - 空分复用技术：如虚拟存储技术

    - 时分复用技术：如虚拟处理器技术

        并发性是虚拟性存在的基础

- **异步性（或不确定性）：** 多个作业的执行过程是走走停停的，其执行顺序和每个作业的执行时间是不确定的。

## 3、操作系统的发展与分类

![image-20220513201053867](https://s2.loli.net/2022/05/13/3AWQXpLSTGkobFC.png)

批处理技术是指计算机系统对一批作业自动进行处理的一种技术。

分类：

- 联机批处理：采用联机输入/输出，即输入/输出操作在监督程序控制下，同步进行。 缺点：速度慢 
- 脱机批处理：外围机：独立于主机，负责把作业任务写入磁带，以及从磁带输出到打印机。主机：负责从磁带上把作业调入内存，或者把结果写回磁带。实现了部分异步能力、减少了CPU的空闲时间、提高了I/O速度

---

多道程序设计：

- **核心思想：** 将多个作业存放在主存中，这些程序在管理程序的控制下交替运行，共享处理机和系统中的其他资源。即通过安排作业（编码与数据）==使得CPU无论何时都有进程执行，从而最大化CPU利用率== 
- 没有提供用户与计算机系统的交互
- 多道程序宏观上并行，微观上串行
- 多道程序设计的道数不是任意的
- **优缺点：** 
    - 提高了CPU的利用率
    - 提高了内存和I/O设备的利用率
    - 改进了系统的吞吐率
    - 充分发挥了系统的并行性
    - 其主要缺点是: 作业周转时间延长
- **多重处理系统:   ** 指配置了多个物理CPU，能真正同时执行多道程序的系统。

---

==操作系统的三种基本类型：批处理操作系统、分时操作系统、实时操作系统== 

分时系统：允许多个联机用户同时使用一台计算机系统进行计算的操作系统称分时操作系统

**分时技术：** 把处理机的运行时间分成很短的时间片，按时间片轮流把处理机分配给各联机作业使用。

是多道程序设计的自然延伸

采用调度算法，以快速切换作业，好像每个作业同时执行

**特征：** 

- 多路性：也称同时性，一台计算机与若干台终端相连接，终端上的这些用户可以同时使用计算机。
- 交互性：用户通过终端采用人机会话的方式直接控制程序运行，同程序进行交互。
- 独立性：用户彼此之间都感觉不到别人也在使用这台计算机，好像只有自己独占计算机一样。
- 及时性：用户请求能在很短时间内获得响应。

## 4、操作系统的运行机制与体系结构

![image-20220513203343485](https://s2.loli.net/2022/05/13/uCvXRb5ixgc4ep9.png)

> 用程序状态字寄存器（PSW， program status word）中的某标志位来标识当前处理器处于什么状态。如0为用户态，1为核心态

---

内核是操作系统的构件，或称基本单位。 

内核作用：  为进程提供管理 、为进程执行提供良好的运行环境

==基本功能:==  

- 中断处理：截获中断，转向中断处理例程
- 短程调度：CPU调度，保存与恢复现场
- 原语管理：原语是不可中断过程

==基本属性:== 

- 内核是由中断驱动的
- 内核的执行是连续的
- 内核在屏蔽中断状态下执行
- 内核可以使用特权指令

==分类：==

- **模块结构（整体式结构）**：将内核划分为一个个独立的模块，模块之间相互调用。效率高但是结构不清晰，访问控制困难

- **层次结构**：一种特殊的模块结构。将内核划分为一系列相互依赖的层次，每个层次也可以分解为一系列更小的模块。

    ![](https://s2.loli.net/2022/03/04/2PkGeSmIBXyOTai.png)

- **微内核结构**

![image-20220513202231353](https://s2.loli.net/2022/05/13/OzmplexJuwFcj24.png)

![image-20220513202617422](https://s2.loli.net/2022/05/13/7S4E6d3gHUeNlpI.png)

## 5、中断和异常

![image-20220513205554625](https://s2.loli.net/2022/05/13/ojrdODLXqEezi3G.png)

==用户态 → 核心态是通过中断实现的，并且中断是唯一途径==

==核心态 → 用户态的切换是通过执行一个特权指令，将程序状态字（PSW）的标志位设置为“用户态”==

![image-20220513205029547](https://s2.loli.net/2022/05/13/twndlTegkLJ6x9X.png)

![image-20220513205136837](https://s2.loli.net/2022/05/13/EYTzjIOvW7drqfx.png)

**外中断的处理过程：**

![image-20220513205420243](https://s2.loli.net/2022/05/13/oRmXYrNvBUkTgfI.png)

## 6、系统调用

![image-20220513213014300](https://s2.loli.net/2022/05/13/xzmwb1KdrT5MIsp.png)

系统调用是操作系统提供给应用程序（程序员/编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，应用程序可以发出系统调用请求来获得操作系统的服务。

系统调用与库函数的区别：

![image-20220513211951839](https://s2.loli.net/2022/05/13/tK9mNhM6OdzepCP.png)

系统调用背后的过程：

![image-20220513212751507](https://s2.loli.net/2022/05/13/obNKP1RrQt9sBuV.png)

中断、异常和系统调用：

|              | 产生原因                                         | 实现机制                     | 区别                                                         | 保存地址                                                 | 处理                                                         |
| ------------ | ------------------------------------------------ | ---------------------------- | ------------------------------------------------------------ | -------------------------------------------------------- | ------------------------------------------------------------ |
| **中断**     | 由定时器和I/O设备产生（来自硬件设备的处理请求）  | 中断机制                     | ①由与现行指令无关的中断信号触发的(异步的)；②中断的发生与CPU处在用户模式或内核模式无关，系统不能确定中断发生的时间 ；③一般来说，中断处理程序提供的服务不是为当前进程所需的 | 保存的是下一条指令的地址，以便在指令结束后检测有没有中断 | **硬件和软件结合** 。①定时器：定时器是OS回收控制的重要方式，可设置为在指定周期（固定或可变）后中断计算机。防止用户程序陷入死循环，或不调用系统服务并且不将控制返回给操作系统。在将控制交到用户之前，操作系统确保定时器已设置好以便产生中断；②中断装置（发生中断源并产生中断的**硬件** ）：发现中断源、保护现场、启动中断处理程序（IDTR寄存器中存放了中断描述符表在内存的起始地址）；③中断处理程序： 保护未被硬件保护的一些必需的处理状态 （CPU自动保存的只有EIP/EFLAGS/ESP/SS/CS） ；识别各个中断源，分析产生中断的原因；处理中断事件；恢复正常操作；④OS必须保证中断前后的同步性，必须保证现场保护的原子性（保护现场的过程不能被中断） |
| **异常**     | 由程序错误产生，或者由内核必须处理的异常条件产生 | 中断机制                     | ① 由处理器正在执行现行指令而引起的； ②异常处理程序提供的服务是为当前进程所用的；③异常包括出错、陷入、终止和编程异常等等；④异常通常由意想不到的行为触发 | 出错保存的是当前指令的地址，陷入保存的是下一条指令的地址 | ①由硬件检测并处理（如除0）；②硬件自身出错产生的异常：通常会在检测错误之后重新执行该指令，CPU保存运行状态；③有些异常是修复后返回并重新执行出错的指令（如页错误）；有些异常是OS通知相应进程；④异常发生在内核会导致OS崩溃 |
| **系统调用** | 程序主动请求操作系统服务                         | 通常通过一种特殊的异常来实现 | 程序主动请求系统服务                                         | 保存的是下一条指令的地址                                 | 提供给用户态程序执行特权操作的接口；触发事件，切换至内核态；传递系统调用的参数； 保存状态以便完成系统调用后恢复执行 |

## 7、==可能的大题：多道程序运行、简答题==

### 甘特图

计算作业完成时间，CPU或者I/O设备的利用率等等

资源利用率：CPU利用率 = CPU有效工作时间/CPU总的运行时间， CPU总的运行时间 = CPU有效工作时间+CPU空闲等待时间。

I/O设备的利用率同理。

==注意考虑优先级以及是否能够抢占==

**（1）**在单CPU和两台I/O(I1,I2)设备的多道程序设计环境下，同时投入三个作业运行。它们的执行轨迹如下：

Job1：I2(30ms)、CPU(10ms)、I1(30ms)、CPU(10ms)

Job2：I1(20ms)、CPU(20ms)、I2(40ms)

Job3：CPU(30ms)、I1(20ms)

如果CPU、I1和I2都能并行工作，优先级从高到低为Job1、Job2和Job3，优先级高的作业可以抢占优先级低的作业的CPU。试求：(1)每个作业从投入到完成分别所需的时间。(2) 每个作业投入到完成CPU的利用率。(3)I/O设备利用率。

**答：**画出三个作业并行工作图如下(图中着色部分为作业等待时间)：

![img](https://s2.loli.net/2022/05/14/FxBnaZuVIQ8Nhe7.png)

(1) Job1从投入到运行完成需80ms，Job2从投入到运行完成需90ms，Job3从投入到运行完成需90ms。

(2) CPU空闲时间段为：60ms至70ms，80ms至90ms。所以CPU利用率为(90-20)/90=77.78%。

(3) 设备I1空闲时间段为：20ms至40ms，故I1的利用率为(90-20)/90=77.78%。设备I2空闲时间段为：30ms至50ms，故I2的利用率为(90-20)/90=77.78%。

 

2、 若内存中有3道程序A、B、C，它们按A、B、C优先次序运行（不考虑强占）。各程序的计算轨迹为：

A：计算(20)、I/O(30)、计算(10) 

B：计算(40)、I/O(20)、计算(10)

C：计算(10)、I/O(30)、计算(20)

如果三道程序都使用相同设备进行I/O(即程序用串行方式使用设备，调度开销忽略不计)。试分别画出单道和多道运行的时间关系图。两种情况下，CPU的平均利用率各为多少?

**答**：分别画出单道和多道运行的时间图

(1) 单道运行时间关系图

  ![img](https://s2.loli.net/2022/05/14/FhG1CTOSvzJu8EM.png)

单道总运行时间为190ms。CPU利用率为(190-80)/190=57.9%

(2) 多道运行时间关系图

  ![img](https://s2.loli.net/2022/05/14/vworFI23sGiWeKp.png)

多道总运行时间为140ms。CPU利用率为(140-30)/140=78.6%
