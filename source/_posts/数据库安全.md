---
title: 数据库安全
tags:
  - 数据库
category:
  - 数据库
abbrlink: 65355
date: 2022-06-27 22:51:26
---

# 四、数据库安全

数据库安全性的定义：对数据库进行安全控制，保护数据库以防止==不合法的使用==（包括对数据库的查询和修改）所造成的数据泄露、更改或破坏。

数据库系统的安全模型：层层设防

<img src="https://s2.loli.net/2022/03/29/Rd34US7IDsHQFx6.png" alt="image-20220329101709334" style="zoom:67%;" />

## 1、用户标识与鉴别

- 概念：一种用来判断用户身份是否属实的机制，是系统提供的**最外层安全保护措施**

    > 标识（Identification）：身份声明。用户标识由用户名和用户标识号组成（用户标识号在系统整个生命周期内唯一）
    >
    > 鉴别（Authentication ）：检验身份声明的有效性

- 用户身份鉴别的方法：

    - 静态口令鉴别：口令一经设置不再改变，静态口令一般由用户自己设定。易于实现也易泄露，不能对抗穷举攻击等等。

    - 动态口令鉴别：口令是动态变化的，一次一密。eg. 手机验证码

    - 生物特征鉴别：通过每个用户所独有的生物特征进行认证的技术

    - 智能卡鉴别：智能卡是一种不可复制的硬件，内置集成电路的芯片，具有硬件加密功能

        可以考虑多种方法并举

- 数据库系统用户认证

    - 系统管理员通过创建用户帐号来管理用户对计算机系统资源的访问.给定==每一位用户一个唯一的标识符和口令==,操作系统通过它来判断用户的身份。
    - DBA负责为DBMS用户建立用户帐号和口令
    - 用户认证的位置和方法：一张有效用户标识符和相关口令清单
    - 方式：通过操作系统/数据库/网络服务认证

## 2、DBMS的存取控制子系统

- 不同的用户有不同的权限，这由数据库的存取控制机制实现.      eg.DBA拥有所有权限

- **所有权：**对象的创建者拥有对象,并能够分配对象的相应特权

- **特权：**

    ==一个策略 两种原则==

    - **最小特权策略**：只有一个人工作需要的才是他应该知道的
    - **“封闭系统”原则**：==默认拒绝==。虽然给予用户访问DBMS的权利，但当==访问特定数据库对象时需要显式的授权==，由DBA或对象的拥有者来执行这个授权过程
    - **“开放系统”原则**：==默认允许==。与封闭系统原则正好相反，允许用户对数据库的所有对象都拥有访问权限，这时,访问控制可通过==显式地去除用户的特权==来实现。简单但不够安全

- **授权控制/访问控制/存取控制：**

    - 概念：授予一个主体权利或特权,使其能够实现对系统或者系统对象的合法访问

    - 组成：定义用户权限、合法权限检查

        <img src="https://s2.loli.net/2022/03/28/yQN8WExhAqHluCX.png" alt="image-20220328184353188" style="zoom:67%;" />

- ==存取控制的策略：==

    - ==自主存取策略：==（Discretionary Access Control , DAC）

        - 概念：是基于用户身份或所属工作组来进行访问控制的一种手段。用户**对于不同的数据对象有相应的存取权限**，而且用户还可以将其拥有的存取权限**转授**给其他用户。

        - 用户分类与权限：

            - 系统用户（或DBA）：拥有全部权限

            - 数据对象的属主：是创建某个数据对象的用户表，拥有该对象的权限

            - 一般用户：经过授权被允许进行特定操作的用户 

            - 公共用户（PUBLIC）：全体用户，便于共享操作而设置

            > SQL中提供CREATE USER 等语句管理用户

        - 授权粒度（用户访问的数据对象的粒度）：数据库/表/字段。

            > 授权粒度越细，授权子系统越灵活，但系统定义与检查权限的开销也越大

        - ![image-20220328185545227](https://s2.loli.net/2022/03/28/v8HkOgAE6nYMCox.png)

            > 谓词是计算结果为逻辑值（为：TRUE、FALSE、UNKNOWN）的逻辑表达式。
            > 不直接支持存取谓词的系统中，通过视图可以间接地实现支持存取谓词的用户权限定义。

        - 自主存取控制是与数据值有关的授权，灵活且易于实现，但由于数据本身并无安全性标志，可能会有无意泄漏问题

    - ==强制存取策略== (Mandatory Access Control, MAC)

        - 定义：是基于被访问对象的信任度进行权限控制的一种手段。每一个数据对象被标以一定的密级，每一个用户也被授予某一个级别的许可证。对于任意一个对象，只有具有合法许可证的用户才可以存取。**对数据本身进行密级标记，无论数据如何复制，标记与数据是一个不可分的整体。**

        - 强制访问控制的实施由DBMS完成，但许可证与密级标记由专门的安全管理员设置

        - 主体：系统中的活动实体，包含用户和用户的进程

        - 客体：系统中的被动实体，被主体操纵

        - 敏感度标记：主体的敏感度标记称为许可证级别；客体的敏感度标记称为密级。

            > 仅当主体的许可证级别大于或等于客体的密级时，该主体才能读取相应的客体；仅当主体的许可证级别（小于或）等于客体的密级时，该主体才能写相应的客体。 **“下读上写”**
            >
            > <img src="https://s2.loli.net/2022/03/28/iWFbB3pIgTkR4GC.png" alt="image-20220328190807758" style="zoom:67%;" />

        - 比较严格和安全

    - ==基于角色的存取控制== (RBAC)

        - 定义：用户通过角色与权限进行关联。每一种角色对应一组相应的权限。一旦用户被分配了适当的角色后，该用户就拥有此角色的所有操作权限。 ==角色本质上是权限的集合== 

            <img src="https://s2.loli.net/2022/03/28/QPHZD64NiTeCOM5.png" alt="image-20220328193107662" style="zoom:67%;" />

        - 优点：简化用户的权限管理，减少系统的开销

            > **SQL中提供CREAT ROLE等语句进行角色管理**

## ==3、授权与回收==

- ==授权：SQL中的GRANT语句==

    - 作用：表(基本表或视图)的所有者授予一个或一类用户访问表的各种权利

    - 局限性：不能根据数据内容进行授权

    - 形式：

        ```sql
        GRANT {ALL PRIVILEGES | privilege[, privilege] ...} #多种权利
        ON [TABLE]{〈tablename〉| 〈viewname〉} #一次针对一个对象
        TO {PUBLIC |〈username〉[,〈username〉] ...} #多个用户，其中PUBLIC是公共用户
        [WITH GRANT OPTION];
        
        #eg
        GRANT SELECT, UPDATE(sno)
        ON TABLE s_c
        TO U1, U2;
        ```

        > 一些说明：
        >
        > - `privilege`包括`SELECT、DELETE、INSERT、UPDATE [columnname [, columnnane]…]、REFERENCES [columnname [, columnnane]…]、ALTER、INDEX等等`，对于视图只有`SELECT、DELETE、INSERT、UPDATE`
        > - `WITH GRANT OPTION`用于实现转授，即被授权的用户还可以将权利授予其他用户，但不允许循环授权
        > - **每条GRANT语句只能针对一个对象（表）**
        > - 可同时向**多个用户**授予对同一对象的**多种权力**
        > - 访问列/行的安全性可以通过视图来实现；在视图上授予更新权限时，视图必须是可更新的；表的所有者自动拥有表的所有权限,而且不能被取消

    ---

- ==回收：SQL中的REVOKE语句== ==GRANT的反操作==

    - 作用：收回已授予给用户的特权

    - 形式： 

        ```sql
        #X/Open SQL的REVOKE语句的语法（基本SQL目前不支持{CASCADE | RESTRICT} 子句）
        REVOKE [GRANT OPTION FOR]
        {ALL PRIVILEGES | privilege[，privilege] ...}
        ON [TABLE]{〈tablename〉| 〈viewname〉}
        FROM {PUBLIC |〈username〉[，〈username〉] ...}
        {CASCADE | RESTRICT};
        
        #eg
        REVOKE INSERT
        ON Staff
        CASCADE
        ```

        > 一些说明：
        >
        > - `GRANT OPTION FOR`指撤销 允许转授 的这种特权
        >
        > - `ALL PRIVIEGES`指该用户被授予的对指定对象所拥有的所有特权
        >
        > - `CASCADE`的作用是删除与当前被撤消的权限有依赖关系的视图或删除依赖于`REFERENCES`权限的外键约束；如果有这样的依赖关系，`RESTRICT`将不允许执行`REVOKE`语句
        >
        > - 其他用户授予该用户的特权不受影响
        >
        >     <img src="https://s2.loli.net/2022/03/29/HAcK2Nrinv83DBR.png" alt="image-20220329112258945" style="zoom:67%;" />

## ==4、角色==

参考链接：[MySQL角色(role)功能介绍 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/367873840)

- 概念：==操作权限的集合==，eg.学生、老师。一个用户可以有不同的角色

    <img src="https://s2.loli.net/2022/03/28/QPHZD64NiTeCOM5.png" style="zoom:67%;" />

- 数据库预定义角色：指数据库建立时，系统自动创建的角色。如CONNECT（允许进入数据库）、RESOURCE（允许创建数据库对象）、DBA

- 与角色相关的SQL语句

    ```sql
    #角色的创建
    CREATE ROLE <角色名> 
    
    #eg
    CREATE ROLE R1;
    ```

    ```sql
    #角色的删除
    DROP ROLE <角色名> 
    ```

    ```sql
    #给角色授权，跟给普通用户的授权是一样的
    GRANT <权限>[,<权限>]...
    ON <对象类型>对象名   #一个对象
    TO <角色>[,<角色>]...
    
    #eg
    GRANT SELECT, UPDATE, INSERT 
    ON TABLE Student 
    TO R1;
    ```

    ```sql
    #查看角色的授权
    mysql> show grants for 'dev_role'@'%';
    +-------------------------------------------+
    | Grants for dev_role@%                     |
    +-------------------------------------------+
    | GRANT USAGE ON *.* TO `dev_role`@`%`      |
    | GRANT SELECT ON `db1`.* TO `dev_role`@`%` |
    +-------------------------------------------+
    ```

    ```sql
    #确定当前会话中哪些角色处于活动状态
    select CURRENT_ROLE();
    ```

    ```sql
    # 使用 set default role 命令激活角色
    mysql> SET DEFAULT ROLE ALL TO dev1;
    Query OK, 0 rows affected (0.77 sec)
    ```

    ```sql
    #将一个角色授予其他的角色或用户，授予者是角色的创建者或拥有在这个角色上的ADMIN OPTION
    GRANT <角色1>[,<角色2>]…
    TO <角色3>[,<用户1>]… 
    [WITH ADMIN OPTION]  #允许转授
    
    #eg
    GRANT R1 
    TO 王平,张明,赵玲;
    ```

    ```sql
    #角色权限的收回，REVOKE的执行者是角色的创建者或者拥有在这个（些）角色上的ADMIN OPTION
    #可以通过回收角色的权限来修改角色的权限
    REVOKE <权限>[,<权限>]…
    ON <对象类型> <对象名>
    FROM <角色>[,<角色>]…
    
    #eg
    REVOKE R1    #本质上，角色就是权限的集合
    FROM 王平;
    
    REVOKE SELECT 
    ON TABLE Student
    FROM R1；
    ```

    > 指定了WITH ADMIN OPTION则获得某种权限的角色或用户还可以把这种权限授予其他角色
    >
    > 一个角色的权限是指直接授予这个角色的全部权限加上其他角色授予这个角色的全部权限

》查询用户权限：SELECT FROM USER …

## 5、视图与权限

- 把要保密的数据对无权存取这些数据的用户隐藏起来，对数据提供一定程度的安全保护

- 进行存取权限控制时可以给不同用户定义不同的视图，把数据对象限制在一定范围内

- 间接地实现支持存取谓词的用户权限定义

    ```sql
    #建立视图
    CREATE VIEW CS_Student
    AS 
    SELECT *
    FROM Student
    WHERE Sdept='CS';
    
    #在视图上进一步定义存取权限
    GRANT SELECT
    ON CS_Student
    TO 王平;
    
    GRANT ALL PRIVILIGES
    ON CS_Student
    TO 张明;
    ```

## 6、审计

- **概念：**把用户对数据库的**所有操作**自动记录下来放入**审计日志**中，DBA可以利用审计跟踪的信息，找出非法存取数据的人、时间和内容等。 

    > 审计日志与恢复机制中的日志的区别：
    >
    > |                    | 审计日志     | 恢复日志       |
    > | ------------------ | ------------ | -------------- |
    > | **记录的内容**     | 所有操作     | 只记录更新操作 |
    > | **记录的组织方式** | 按操作的对象 | 按时间顺序     |

- **作用**：调查可疑的活动；监视并收集某类数据库活动的信息

- **可选性**：DBA可以根据应用对安全性的要求，灵活地打开或关闭审计功能以及选择对哪些操作进行审计

    > 审计很费时间和空间，主要用于安全性要求较高的部门

- **审计事件**：服务器事件、系统权限（对系统拥有的结构或模式对象进行操作的审计）、语句事件、模式对象事件

- **审计功能**：审计分析和报表功能、审计日志管理功能（审计日志必须先转储后删除；只允许审计员查阅和转储审计记录；…）、提供专门视图等等

## 7、数据加密与统计数据库的安全

- 数据加密

    - 作用：通过将明文转换为密文来防止数据库中数据在存储和传输中失密
    - 两种加密方法：替换、置换（更改明文顺序）
- 统计数据库的安全性

    - 统计数据库允许用户查询**聚集类型**的信息（例如合计、平均值等），但是不允许查询单个记录信息。
    - 统计数据库中的安全性问题：可能存在着隐蔽的信息通道，使得可以从合法的查询中推导出不合法的信息。
    - 解决办法：

        - 规定任何查询至少涉及N个以上的记录
        - 规定两个查询的相交数据项不能超过M个
