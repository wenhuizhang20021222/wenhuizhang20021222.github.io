---
title: 数据库设计
tags:
  - 数据库
category:
  - 数据库
abbrlink: 41739
date: 2022-06-27 22:54:40
---

# 五、数据库设计

## 1、ER图中的基本概念

### 现实世界、ER模型、关系模型中的概念对应

<img src="https://s2.loli.net/2022/04/13/f43azBqyCJXxniM.png" alt="image-20220413170050668" style="zoom:67%;" />

### 实体类型和实体实例

- 实体类型：一个属性集

    > 实体类型可以是物理上的，如staff；也可以是概念上的，如work experience

- 实体实例：对应于实体类型下的一个取值，实体实例是可区别的

    > 例子：
    >
    > 学生是一个实体类型，可以用（学号，姓名，性别，年龄，所属系）这个属性集来描述学生，每一个学生，如学生i，是学生实体的一个实体实例；

### 属性

- 属性（attribute）：实体类型==或联系类型==所具有的某一特性

- 属性域（attribute domain）：单个属性或多个属性所允许的值的集合

- ==简单属性==（simple attribute）：由单个部分组成的属性，可独立地存在

- ==复合属性==（composite/component attribute）：共同描述一个性质的一组简单属性。  eg. 地址（可以分为省市县等等）、姓名（last name， first name）

    > 复合属性的处理：把复合属性拆分成多个属性，还是放在原来的表里

---

- ==单值属性==（single-valued attribute）：在一个实体实例中只有单独一个值

- ==多值属性==（multi-valued attribute）：在一个实体实例中可以取多个值的属性。eg.  电话、爱好等等

    > 多值属性的处理：用单独的表来处理

- 导出属性（derived attribute）：由相关的一个属性或一组属性的值导出，在同一个实体类型中该属性并不是必要的。  eg.  年龄（可以根据生日来计算）

    > 导出属性的处理：大部分情况下不保存，用的时候直接计算

---

- 候选关键字（candidate key）：能唯一标识每个实体实例的最小属性组
- 主关键字（primary key）：实体类型中被选来唯一标识每个实体实例的候选关键字
- 复合关键字（composite key）：包括两个或更多属性的候选关键字。eg.  SC表，学号和课程号构成复合关键字

### 联系类型

- 联系类型（relationship type）：实体类型间的一组有意义的关联

- 联系实例（relationship occurrence）：一个可唯一标识的关联，涉及参与该联系的每个实体类型的一个实例

    > 联系类型和联系实例是型和值的关系

- 联系类型的度（degree of a relationship type）：参与联系的实体类型的个数。度为2的联系称为二元联系；度为3的称为三元联系；度为3或更高的联系，称为多元联系

    > 例如：学生选课，学生和课程，二元联系

- 递归联系（recursive relationship）：是这样一种联系类型，其同一个实体类型参与的次数大于1，并且每次参与具有不同角色.递归联系也称为一元联系。

    > 例如：学生选班干

### 简单E-R图

#### （1）联系类型的图形化表示：

- 一元联系（递归联系）：

    <img src="https://s2.loli.net/2022/04/13/KusxJgkM6jNB3vY.png" alt="image-20220413183610740" style="zoom:67%;" />

- 二元联系：每个联系类型都表现为连接相关联实体类型的一条线，在线上标明该联系的名字,通常用一个动词或动词短语。箭头表示联系的方向。

    ![image-20220413182921721](https://s2.loli.net/2022/04/13/lzYsi72DWPxHgoj.png)

- 三元联系：用菱形表示度大于2的联系，联系名放在菱形内部

    <img src="https://s2.loli.net/2022/04/13/DcAMZWVklYqTdU1.png" alt="image-20220413183338386" style="zoom:67%;" />

    > 四元联系与三元联系类似

- 两个实体之间存在多于一种联系时课使用角色名

    <img src="https://s2.loli.net/2022/04/13/AEn5ze4rsiGZUQ6.png" alt="image-20220413183823327" style="zoom:67%;" />

#### （2）属性的图形化表示

- ==实体的属性：==在一个实体类型中显示其属性时，将实体类型的矩阵分为两个部分：上部分是实体的名字，下部分列出实体属性的名字。

    - 对于主关键字属性,第一个列出，并在其名字后面标记{PK}，
    - 在部分主关键字属性的名字后标记{PPK}
    - 对于候选关键字属性的名字后面标记{AK}
    - 简单属性和单值属性没有必要标记
    - 对于复合属性，在其名下以右缩进形式列出子属性名
    - 对于多值属性，在属性名后面注明它的取值范围
    - 对于导出属性，在属性名前加上前缀“/

    例子：

    <img src="https://s2.loli.net/2022/04/13/OvTZMpQCNzlRu9t.png" alt="image-20220413184441872" style="zoom:67%;" />

- ==联系的属性==：采用与实体类型相同的符号，但用==虚线==将表示联系属性的矩形与联系类型名连接起来

    <img src="https://s2.loli.net/2022/04/13/8plaIBwcOfkeZ1T.png" alt="image-20220413184614803" style="zoom:67%;" />

### 弱实体类型和强实体类型

- ==强实体类型==(Strong entity type) （父实体，属主实体(owner entity)，支配实体）：该实体类型的存在不依赖于其他的实体类型

- ==弱实体类型==(Weak entity type) （子实体，依赖实体，从属实体）：该实体类型的存在依赖于其他实体类型的存在

    > 弱实体类型的一个特征是，仅使用该实体类型的属性无法唯一标识每个实体实例。 eg. 两个学生是同班同学，学习经历相同。

    > 例子：<img src="https://s2.loli.net/2022/04/13/KwhYO63iC9AkLG4.png" alt="image-20220413185233053" style="zoom:67%;" />

## 2、 结构化约束

- 概念：ER模型的结构化约束是指参与一个联系的实体类型上存在的约束

- ==多样性==：联系上的主要约束称为多样性，包括基数约束和参与约束。指的是在一个特定的联系中，一个参与实体类型的某个实例，可能与另一个参与实体类型发生关联的实例的数目（或范围）

    > - 基数约束(cardinality constraints)： 描述一个特定联系类型中的一个实体==最多==可参与联系的实例数目(==最大基数==) 
    >
    > - 参与约束（participation constraints）：说明是否所有的实体实例都参与了联系(==最小基数==) 
    >
    >     - 强制参与（mandatory participation）：一个实体类型的所有实例都参与联系。x为1
    >     - 可选参与（optional participation ）：一个实体类型的部分实例参与约束。x为0
    >
    > - ==看约束：固定n - 1方，看另一方==
    >
    >     <img src="https://s2.loli.net/2022/04/13/1wB9IzoaCvGTmSj.png" alt="image-20220413191540919" style="zoom:67%;" />
    >
    >     某个分支机构的某个职员可以拥有0个或者多个客户

- 范围的表示：范围表示为==x..y==,其中x为最小参与数目（参与约束）(用0表示0,用1表示大于0),y为最大参与数目（基数约束）(用1表示1,用*或N表示大于1)

- 例子：

    - 一对一联系的多样性

        <img src="https://s2.loli.net/2022/04/13/Pi8boG26YmrvpZf.png" alt="image-20220413190419081" style="zoom:67%;" />

    - 一对多联系的多样性

        <img src="https://s2.loli.net/2022/04/13/42ZoVecLI9K8TjC.png" alt="image-20220413190430930" style="zoom:67%;" />

    - 多对多联系的多样性

        <img src="https://s2.loli.net/2022/04/13/X3becj8krD4TuYo.png" alt="image-20220413190445972" style="zoom:67%;" />

        <img src="https://s2.loli.net/2022/04/13/lBaznOJ2CUfdPcR.png" alt="image-20220413191346428" style="zoom:80%;" />

## 3、ER模型的问题

### 连接陷阱

由于对特定联系含义的错误理解而引起的问题。

### 扇形陷阱(fan trap)：

当用模型来表示实体间的联系时，某些特殊实体实例间的道路是不明确的

<img src="https://s2.loli.net/2022/04/13/DPqiV6CSAW3krht.png" alt="image-20220413192231143" style="zoom:67%;" />

<img src="https://s2.loli.net/2022/04/13/zHBIxnosYPqXZt2.png" alt="image-20220413192245233" style="zoom:67%;" />

### 深坑陷阱(chasm trap)：

当一个模型暗示某些实体类型之间存在联系，而这些实体实例间却不存在相应的道路

<img src="https://s2.loli.net/2022/04/13/DZjGTJOHfSF2VuY.png" alt="image-20220413192355668" style="zoom:67%;" />

<img src="https://s2.loli.net/2022/04/13/vkUdu8rwRaBSiYf.png" alt="image-20220413192412310" style="zoom:67%;" />

## 4、  增强的ER模型（EER）

- ER模型的局限性：冗余

- ==超类：==其实例构成一个或多个独立子集且各独立子集在数据模型中要显示的实体类型。含有独立子类的实体类型称为超类。例如staff

- ==子类：==某实体类型的一个独立实例集合，并需要在数据模型中单独表示。

    > eg.  Staff实体类型的实体成员可分为Manager, SalesPersonnel和Secretary,
    >
    > Staff可以看成超类，Manager, SalesPersonnel和Secretary应看作子类

- 超类和子类的联系：

    - 子类中的一个实体也是超类的一个实体
    - 超类/子类联系是一对一的
    - 有些超类的子类可能重叠（**不相交约束**：相交的、不相交的）。例如，一名职员可以既是经理，又是销售人员
    - 并不是超类中的每个实体都必须是子类中的实体（**参与约束**：强制的、可选的）。例如，有些职员没有明显的一类工作角色，比如说既不是经理，也不是销售人员

- 将超类和子类的概念引入ER模型的主要原因：避免对相似的概念进行重复的描述

- 属性继承：子类除了拥有其所在子类特有的属性外，同时还具有（继承）超类的所有属性

- 共享子类：一个子类有不止一个超类时，称这个子类为共享子类

    ==在UML图中，三角形的尖指向超类==

    <img src="https://s2.loli.net/2022/04/13/JjODx9q1p4Ngo2s.png" alt="image-20220413195615579" style="zoom:67%;" />

- 多重继承：超类的属性都被共享子类继承，同时共享子类还可以有自己的附加属性，这种继承称为多重继承

- **类型层次（自上而下）**：子类也可以有自己的子类。这样构成的子类层次称为类型层次

- **概化层次（自下而上）**：多个有公共属性的实体可以概化为一个更高层次的超类实体（supertype entity）,或者相反，一个一般化实体可以分解成低层次的子类实体（subtype entity）

## 5、  特殊化、概化

- 特殊化过程(specialization process)：==自上而下== 。通过标识实体成员间的差异特征将这些成员间的差异最大化的过程

- 概化过程(generalization process)：==自下而上==。通过标识实体成员间的共同特征将这些成员间的差异最小化的过程

    <img src="https://s2.loli.net/2022/04/19/YXJewcjOgv5nBGT.png" alt="image-20220419102322804" style="zoom:67%;" />

- 特殊化/概化约束：

    - ==参与约束==：确定超类中的每个成员是否都必须是子类中的成员。

        - 强制的参与约束（Mandatory）：超类中的每个成员都必须是子类中的成员
        - 可选的参与约束（Optional）：超类中的成员并不一定也是子类中的成员

    - ==不相交约束==：描述子类成员间的联系。子类成员之间是相交（AND）的或者不相交（OR）的

        > ==参与约束和不相交约束是独立的，因此可以组合成4种约束==

<img src="https://s2.loli.net/2022/04/19/zRnwamC5L82ekQI.png" alt="image-20220419102930019" style="zoom:67%;" />

## 6、  聚合与组合

- ==聚合(aggregation）==：表示实体类型之间的“具有”(has-a)和“属于”**(is-part-of)**联系，这些实体中有一个表示整体，其他的表示部分。如汽车和轮子

    >  <img src="https://s2.loli.net/2022/04/19/ljstSaZ9Vmc1u3B.png" alt="image-20220419103229323" style="zoom: 67%;" />

- ==组合（composition）：==一种特殊形式的聚合，即整体对部分存在强拥有权，且==两者具有一致的生存期==

    > 例如：汽车和轮子，轮子是可以单独存在的；而房子和房间，如果房子没了。那房间也不存在了

    <img src="https://s2.loli.net/2022/04/13/o2piID5CdsX84M9.png" alt="image-20220413202610135" style="zoom:67%;" />

- ==概括==：定义了类型之间的一种子集联系，它抽象了类型之间的**is subset of**的语义。如学生和本科生

    例子：

    <img src="https://s2.loli.net/2022/04/14/K2ZBMf5Ln4SePD3.png" alt="image-20220414123506992" style="zoom:67%;" />

## 7、  局部视图设计及合并ER图

- 根据局部结构设计分ER图，即局部ER图

- 合并ER图

    - 方法：二元合并法或者多元合并法

    - 冲突处理：

        - 属性冲突：包括属性域冲突和属性取值单位冲突

            解决方法：取尽可能多的包含较多局部ER图要求的数据类型、值域或取值单位，并可考虑今后系统维护的工作量作为取舍

        - 命名冲突：包括同名异义和异名同义。解决方法：重新命名

        - 结构冲突：

            - 同一对象在不同应用中具有不同的抽象（解决方法：统一为实体或属性）
            - 同一对象在不同局部ER图中所包含的属性不完全相同，或属性的排列次序不完全相同（解决方法：使该实体的属性取各局部ER图中属性的并集，再适当调整属性的次序）
            - 实体之间的联系在不同局部ER图中呈现不同的类型（解决方法：根据应用的语义对实体联系的类型进行综合或调整）

    - 消除数据冗余

        - 用分析法消除冗余数据（😢其实就是观察法），例如实发工资可以由其他列推算得到，则可以删去实发工资

        - 用规范化消除冗余联系，可以通过求最小依赖集来实现

            ![image-20220414142449087](https://s2.loli.net/2022/04/14/wFm5a2JVHkYrSqd.png)

例子:

![image-20220414124835366](https://s2.loli.net/2022/04/14/WxGbp3khOcZijf7.png)

![image-20220414124850694](https://s2.loli.net/2022/04/14/CndNF5YtxWcRaJO.png)

## ==8、  将ER模型转换为关系模型==

- ER结构与关系结构的对应关系

    <img src="https://s2.loli.net/2022/04/13/XP6twnef4rG2bgH.png" alt="image-20220413203447160" style="zoom:67%;" />

- ==将ER模型转换为关系模型的9步算法==

    <img src="https://s2.loli.net/2022/04/13/zPa9jNSdThUeH1B.png" alt="image-20220413203911206" style="zoom:67%;" />

#### （1）强实体的转换：直接转换成一张表

<img src="https://s2.loli.net/2022/04/13/Zps7gCADun8rBGI.png" alt="image-20220413204026593"  />

#### （2）仅参与一个1:1联系的弱实体的转换

![image-20220413204240217](https://s2.loli.net/2022/04/13/o4OXdy1nNVpeR9b.png)

#### （3）参与1:N或M:N联系的弱实体的转换**

将参与一个1:N或M:N或多个联系的弱实体W，转换为一张表T，表中包括弱实体的所有的单值属性或复合属性的组成属性。

- 若强实体S与弱实体W之间是==1:N联系，则T的主键 = W的主关键字+S的主关键字==

    ![image-20220413205556256](https://s2.loli.net/2022/04/13/xJ3vpA51YfnkU9P.png)

- 若强实体S与弱实体W之间是==M:N联系，则T的主键=一个新创建的具有唯一值的属性X==，而实体间的联系在step six处理

    > 如果采用T的主键 = W的主关键字+S的主关键字，会造成冗余

    <img src="https://s2.loli.net/2022/04/13/sBSwXZjvz4D6YlP.png" alt="image-20220413231701028" style="zoom:67%;" />

    > 父子关系等等可以作为联系的属性
    >
    > <img src="https://s2.loli.net/2022/04/19/2SrvHy1h3oebWnA.png" alt="image-20220419103909683" style="zoom: 33%;" />

#### （4） 1:1 的联系的转换

- 两方都强制参与：将两个实体组合为一个关系T，然后将联系属性加入到关系T中

    <img src="https://s2.loli.net/2022/04/13/nWRxKhXNc5mlqdi.png" alt="image-20220413231857172" style="zoom:67%;" />

- 一方强制参与：将可选方实体的主关键字作为强制方实体的关系的外部关键字，然后将联系属性加入到强制实体的关系中

    > 如果放到可选参与方，会造成空间浪费，因为会有空的；强制参与方就不会有空的

    <img src="https://s2.loli.net/2022/04/13/lgyLBaHn9iD2RYU.png" alt="image-20220413232130399" style="zoom:67%;" />

- 两方都可选参与：若没有进一步的信息，可选任一可选实体当作强制实体，使用方法（2）转换

    <img src="https://s2.loli.net/2022/04/13/ThBVvoKfijR7cy9.png" alt="image-20220413232412596" style="zoom:67%;" />

#### （5）1:N 的联系的转换

对于任意一个1:N联系，一方实体的主关键字作为多方实体关系的外部关键字，该联系的任何属性也安排在多方

> 如果放到一方实体的话，则会造成多值

<img src="https://s2.loli.net/2022/04/13/k8dJuPe6AByfCE2.png" alt="image-20220413232534635" style="zoom:67%;" />

#### （6） N元联系（涉及N个实体）（包括N:M 的联系）的转换

对于任意一个M:N联系或N元联系，==生成一个表示该联系的关系R（注意外键），==关系R包含该联系的所有属性以及作为R的外部关键字出现的所有属主实体的主关键字

<img src="https://s2.loli.net/2022/04/13/PgsECqprb1HOG3Q.png" alt="image-20220413232804774" style="zoom:67%;" />

<img src="https://s2.loli.net/2022/04/13/dxnKtID86QFU7T5.png" alt="image-20220413232956311" style="zoom:67%;" />

> 同一实体集的实体间的联系，即自联系，也可按上述1:1， 1：n， m：n的3种情况分别处理

#### （7） 复合属性、多值属性和派生属性的处理

- ==复合属性==：为每个子属性创建一个单独的属性而将复合属性去掉
- ==多值属性==：将多值属性生成为一个表示该属性的关系，**并把该属性的属主实体的主关键字作为该关系的外部关键字**
- ==派生属性==：从关系模式中去掉

<img src="https://s2.loli.net/2022/04/13/j9uenoirmIlq4Mc.png" alt="image-20220413233231580" style="zoom:67%;" />

#### （8） 子类不相交的超类/子类联系的转换

对于每个具有强制参与且不相交子类的超类/子类联系-- {Mandatory, Or}

- 对于每个子类Si，创建一个新表Ti; 

- 将超类的简单属性和复合属性的简单组合属性放入Ti的属性集中；

- 将Si的简单属性和复合属性的简单组合属性放入Ti的属性集中；

- 标识主键和候选键。

    ==超类不创建表（因为是强制参与且不相交，超类中的某个成员一定属于且仅属于某一个子类），各组合的超类/子类一个表==

    <img src="https://s2.loli.net/2022/04/13/1DFPGLpnarTCXv9.png" alt="image-20220413233638204" style="zoom:67%;" />

#### （9） 子类相交的超类/子类联系的转换

对于每个具有相交子类 或 可选参与且不相交子类的超类/子类联系（即除了{Mandatory, Or}之外的三种组合约束）

- 对于超类，创建一个新表O; 

- 将超类的简单属性和复合属性的简单组合属性放入O的属性集中；

- 标识O的主键和候选键；

- 对于每个子类Si，创建一个新表Ti; 

- 将Si的简单属性和复合属性的简单组合属性放入Ti的属性集中；

- **将O的主键放入Ti的属性集中，作为Ti的外键**

    ==超类创建一个表，各子类一个表==

<img src="https://s2.loli.net/2022/04/13/vscW9OjZQRDkaIP.png" alt="image-20220413234448229" style="zoom:67%;" />
